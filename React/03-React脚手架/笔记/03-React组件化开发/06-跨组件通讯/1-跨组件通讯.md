å‰é¢æˆ‘ä»¬å·²ç»å­¦ä¹ äº†çˆ¶å­ç»„ä»¶çš„é€šè®¯ï¼Œæ˜¯é€šè¿‡propså®ç°çš„ï¼Œä½†æ˜¯åœ¨å®é™…å¼€å‘ä¸­ï¼Œå¯èƒ½ç»„ä»¶åµŒå¥—çš„å…³ç³»éå¸¸æ·±ï¼Œé‚£ä¹ˆè¿™ç§è·¨ç»„ä»¶çš„é€šè®¯æ€ä¹ˆå®ç°å‘¢ï¼Ÿ

æœ¬æ–‡å°†è¯¦ç»†è®²è§£è·¨ç»„ä»¶é€šè®¯çš„å‡ ç§æ–¹æ³•ã€‚

1. propsï¼ˆå±‚çº§è¾ƒæ·±æ—¶ä¸æ¨èä½¿ç”¨ï¼‰
2. Context
3. äº‹ä»¶æ€»çº¿

ä¸‹é¢ä»¥Profileç»„ä»¶çš„å®ç°è¿‡ç¨‹ä¸ºä¾‹ï¼Œå¯¹æ¯”ä¸‰ç§å®ç°è·¨ç»„ä»¶é€šè®¯æ–¹å¼çš„ä¸åŒä¹‹å¤„ã€‚

# props

â€‹	å‰é¢å®ç°çˆ¶å­ç»„ä»¶é€šè®¯ä½¿ç”¨çš„å°±æ˜¯propsï¼Œé‚£ä¹ˆæ·±å±‚æ¬¡åµŒå¥—çš„ç»„ä»¶é€šè®¯å½“ç„¶ä¹Ÿå¯ä½¿ç”¨propsé€å±‚ä¼ é€’ï¼Œåªä¸è¿‡è¿™æ ·çš„æ“ä½œç¼ºç‚¹å¾ˆå¤šï¼š

1. äº§ç”Ÿå¾ˆå¤šé‡å¤ä»£ç 
2. ä¸ºäº†èƒ½è®©æ•°æ®ä¼ é€’åˆ°ç›®æ ‡ç»„ä»¶ï¼Œä¸€äº›ä¸éœ€è¦propsçš„ä¸­é—´ç»„ä»¶ä¹Ÿå°†è¢«è¿«è¿›è¡Œpropsçš„æ¥æ”¶å’Œä¼ é€’ã€‚

## ç‰ˆæœ¬ä¸€

```
export default class App extends Component {
  constructor() {
    super();
    this.title = "Ashuntefannao";
    this.state = {
      nickName: "Ashun",
      level: 99,
    };
  }
  render() {
    let { nickName, level } = this.state;
    return (
      <div id="main">
        <h2>{this.title}</h2>
        <Profile nickName={nickName} level={level} />
      </div>
    );
  }
}

function Profile(props) {
  let { nickName, level } = props;	{/* ä¸ºäº†èƒ½è®©æ•°æ®ä¼ è‡³ProfileContent,ä¹Ÿè¦æ¥æ”¶ã€ä¼ é€’props */}
  return (
    <div id="profile">
      <header>profile</header>
      <ProfileContent nickName={nickName} level={level} />	
    </div>
  );
}
function ProfileContent(props) {
  return (
    <div className="ProfileContent">
      <ul>
        <li>{props.nickName}</li>
        <li>{props.level}</li>
      </ul>
    </div>
  );
}
```

## ä¼˜åŒ–:å±•å¼€è¯­æ³•

ä¸Šé¢åªæ˜¯ä¼ å…¥äº†ä¸¤æ¡æ•°æ®ï¼Œå°±äº§ç”Ÿäº†å¤§é‡å†—ä½™ä»£ç ï¼Œæœ‰æ²¡æœ‰åŠæ³•è®©ä¼ é€’çš„è¿‡ç¨‹ç»™æ›´åŠ ç®€æ´å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ï¼šæœ‰çš„ã€‚

Reactæ”¯æŒï¼šå°†ä¼ é€’çš„å„ä¸ªå±æ€§è¿›è¡Œ**è§£æ„èµ‹å€¼**ã€‚

```
export default class App extends Component {
  constructor() {
    super();
    this.title = "Ashuntefannao";
    this.state = {
      nickName: "Ashun",
      level: 99,
    };
  }
  render() {
    return (
      <div id="main">
        <h2>{this.title}</h2>
        <Profile {...this.state} />		{/* å°†stateè§£æ„ä¼ å…¥ */}
      </div>
    );
  }
}

function Profile(props) {
  return (
    <div id="profile">
      <header>profile</header>
      <ProfileContent {...props} />		{/* å°†æ¥æ”¶åˆ°çš„propsè§£æ„ä¼ å…¥ */}
    </div>
  );
}
function ProfileContent(props) {
  return (
    <div className="ProfileContent">
      <ul>
        <li>{props.nickName}</li>
        <li>{props.level}</li>
      </ul>
    </div>
  );
}
```

# Context

â€‹	å‰é¢ä½¿ç”¨propsæ˜¯æœ€ä¼ ç»Ÿï¼Œä¹Ÿæ˜¯æ¯”è¾ƒç¬¨çš„åŠæ³•ã€‚è€Œä¸”ï¼Œè™½ç„¶ä¸Šé¢å·²ç»ä½¿ç”¨`å±•å¼€è¯­æ³•`è¿›è¡Œäº†ä»£ç æ•°é‡çš„ä¼˜åŒ–ï¼Œä½†ä¸­é—´ç»„ä»¶è¢«è¿«è¿›è¡Œæ•°æ®ä¼ é€’çš„é—®é¢˜è¿˜æ˜¯æ²¡æœ‰è§£å†³ï¼Œå¦‚æœåµŒå¥—å±‚çº§å¾ˆæ·±ï¼Œä»£ç å†—ä½™è¿˜æ˜¯å¾ˆå¤šã€‚

â€‹	è¿™æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨Contextç›¸å…³APIè¿›è¡Œå®ç°ã€‚

## è¿‡ç¨‹æ¢³ç†ï¼š

### åˆ›å»ºContextå¯¹è±¡

é¦–å…ˆï¼Œæˆ‘ä»¬è¦åˆ›å»ºä¸€ä¸ªéœ€è¦å…±äº«çš„Contextå¯¹è±¡ï¼š

```
const MyContext = React.createContext(defaultValue);
```

* å¦‚æœä¸€ä¸ªç»„ä»¶è®¢é˜…äº†æŸä¸ªContextï¼Œé‚£ä¹ˆè¿™ä¸ªç»„ä»¶ä¼šä»ç¦»è‡ªèº«æœ€è¿‘çš„é‚£ä¸ªçˆ¶çº§ `Provider` ç»„ä»¶ä¸­è¯»å–åˆ°å½“å‰çš„å¯¹åº”çš„contextå€¼ï¼›ï¼ˆ`Provider` ç»„ä»¶ï¼Œåæ–‡ä¼šè®²è§£ï¼‰

* defaultValueæ˜¯ç»„ä»¶åœ¨æ”€å±‚çº§æŸ¥æ‰¾çš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœç›´è‡³æœ€é¡¶çº§éƒ½æ²¡æœ‰æ‰¾åˆ°å¯¹åº”çš„`Provider`ï¼Œé‚£ä¹ˆå°†ä½¿ç”¨é»˜è®¤å€¼

---

### Context.Providerç»„ä»¶

Contextå…±äº«å¯¹è±¡åˆ›å»ºå®Œæ¯•åï¼Œæˆ‘ä»¬è¦ä½¿ç”¨Context.Providerç»„ä»¶ï¼Œé€šè¿‡é…ç½®valueå±æ€§ï¼Œå®šä¹‰æ‰€è¦å…±äº«çš„æ•°æ®ï¼Œå¹¶å°†é‚£äº›éœ€è¦å…±äº«æ•°æ®çš„ç»„ä»¶è¿›è¡ŒåŒ…è£¹ã€‚

```
<MyContext.Provider value={â€¦â€¦}>
	<SubscribeCpn1 />
	<SubscribeCpn2 />
	â€¦â€¦
</MyContext.Provider>
```

æ¯ä¸ª `Context` å¯¹è±¡éƒ½ä¼šè¿”å›ä¸€ä¸ª `Provider` React ç»„ä»¶ï¼Œå®ƒå…è®¸æ¶ˆè´¹ç»„ä»¶è®¢é˜… context çš„å˜åŒ–ï¼Œå½“ Provider çš„ `value` å€¼å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå®ƒå†…éƒ¨çš„æ‰€æœ‰æ¶ˆè´¹ç»„ä»¶éƒ½ä¼šé‡æ–°æ¸²æŸ“ï¼›

- Provider æ¥æ”¶ä¸€ä¸ª `value` å±æ€§ï¼Œä¼ é€’ç»™æ¶ˆè´¹ç»„ä»¶ï¼›

- ä¸€ä¸ª Provider å¯ä»¥å’Œå¤šä¸ªæ¶ˆè´¹ç»„ä»¶æœ‰å¯¹åº”å…³ç³»ï¼›

- å¤šä¸ª Provider ä¹Ÿå¯ä»¥åµŒå¥—ä½¿ç”¨ï¼Œé‡Œå±‚çš„Provider ä¼šè¦†ç›–å¤–å±‚çš„æ•°æ®

  >å› ä¸ºä¸Šæ–‡ï¼ˆåˆ›å»ºContextå¯¹è±¡ï¼‰ä¸­ï¼Œå·²ç»è¯´æ˜äº†ç»„ä»¶è®¢é˜…çš„è§„åˆ™ï¼šç»„ä»¶ä¼šä»ç¦»è‡ªèº«æœ€è¿‘çš„é‚£ä¸ªçˆ¶çº§ `Provider` ç»„ä»¶ä¸­è¯»å–åˆ°å½“å‰çš„å¯¹åº”çš„contextå€¼

**â­æ³¨æ„ç‚¹ï¼šè®¢é˜…Contextçš„ç»„ä»¶ï¼Œè¦æ”¾åœ¨Context.Providerç»„ä»¶æ ‡ç­¾çš„å†…éƒ¨**

â€‹	å¦‚æœè®¢é˜…Contextçš„ç»„ä»¶ï¼Œæ²¡æœ‰æ”¾åœ¨Context.Providerç»„ä»¶æ ‡ç­¾å¯¹ä¸­ï¼Œåˆ™åœ¨æ”€å±‚è¿‡ç¨‹ä¸­ï¼Œå°†ä¸èƒ½å¤Ÿå¯»æ‰¾åˆ°Context.Providerç»„ä»¶æ‰€å…±äº«çš„æ•°æ®ã€‚

---

### Class.contextType

ç»è¿‡ä¸Šé¢çš„æ“ä½œï¼šContextå…±äº«å¯¹è±¡åˆ›å»ºå®Œæ¯•ï¼ŒContext.Providerç»„ä»¶é…ç½®å®Œæ¯•ã€‚

ç°åœ¨åªéœ€è¦æœ€åä¸€æ­¥ï¼šè®©è®¢é˜…ç»„ä»¶ï¼Œè®¢é˜…ç›®æ ‡Contextå¯¹è±¡ã€‚

æˆ‘ä»¬éœ€è¦ä¸ºè®¢é˜…ç»„ä»¶å®šä¹‰`contextType`é™æ€å±æ€§ï¼Œå€¼ä¸ºï¼šæ‰€è®¢é˜…çš„Contextå¯¹è±¡

```
SubscribeCpn.contextType = MyContext
```

å½“ç„¶ï¼Œæˆ‘ä»¬è¿˜å¯é€šè¿‡`static`å…³é”®å­—ï¼Œåœ¨classå†…éƒ¨è¿›è¡Œé…ç½®

```
class SubscribeCpn extends Component {
  static contextType = MyContext;
  render(){â€¦}
}
```

æˆåŠŸè®¢é˜…åï¼Œåœ¨ç»„ä»¶å†…éƒ¨å°±å¯é€šè¿‡`this.context["propName"]`è¿›è¡Œæ•°æ®è®¿é—®äº†ã€‚

**â­æ³¨æ„ç‚¹ï¼šè‹¥ä½¿ç”¨è¯¥å½¢å¼ï¼Œåˆ™è®¢é˜…Contextçš„ç»„ä»¶å¿…é¡»æ˜¯classç±»ç»„ä»¶**

å½“ç„¶ï¼Œ`å‡½æ•°ç»„ä»¶`ä¹Ÿæ˜¯å¯ä»¥ä½¿ç”¨Contextçš„ï¼Œåªä¸è¿‡ä½¿ç”¨çš„æ˜¯`Context.Consumer`ï¼Œå…·ä½“çœ‹ä¸‹æ–‡ğŸ‘‡

---

### Context.Consumerç»„ä»¶

`Context.Consumer`æœ‰ä¸¤ä¸ªåŠŸèƒ½ï¼š

1. ç”¨äºå¤„ç†`ä½¿ç”¨å¤šä¸ªContext`æ—¶çš„æƒ…å†µã€‚--ä¸‹æ–‡ï¼ˆä½¿ç”¨å¤šä¸ªContextï¼‰éƒ¨åˆ†è¿›è¡Œè¯¦è§£
2. è®©å‡½æ•°è®¢é˜…ç»„ä»¶ï¼Œè¿›è¡Œè®¢é˜…



`å‡½æ•°è®¢é˜…ç»„ä»¶`ä½¿ç”¨ContexAPIçš„æ­¥éª¤ï¼Œç›¸å¯¹äº`classè®¢é˜…ç»„ä»¶`ä½¿ç”¨è¿‡ç¨‹æ¥è¯´ï¼Œåªæœ‰åœ¨**è®¢é˜…**æ—¶çš„æ“ä½œä¸åŒã€‚æ­¥éª¤å¦‚ä¸‹ï¼š

1. JSX å¤–éƒ¨éœ€è¦åµŒå¥—ä¸€å±‚å‡½æ•°ï¼Œè¯¥å‡½æ•°æ¥æ”¶ä¸€ä¸ªcontextå‚æ•°ï¼ˆå†…éƒ¨çš„JSXå°±å¯ä½¿ç”¨è¯¥å‚æ•°è®¿é—®å…±äº«çš„æ•°æ®ï¼‰ï¼Œå†å°†JSXè¿”å›å‡ºå»å³å¯ã€‚

   > ç”±äºï¼ŒJSX å¤–éƒ¨åµŒå¥—äº†å‡½æ•°ï¼Œæ‰€ä»¥è¦å°†æ•´ä½“éƒ¨åˆ†ä½œä¸ºJavaScriptå˜é‡ï¼Œæ’å…¥åˆ°`{}`ä¸­

2. å°†ç¬¬ä¸€æ­¥ä¸­çš„ä»£ç å— ä½¿ç”¨**`Context.Consumer`**ç»„ä»¶è¿›è¡ŒåŒ…è£¹ï¼Œå¹¶å°†è¿™ä¸ªæ•´ä½“ä½œä¸ºå‡½æ•°ç»„ä»¶çš„è¿”å›å€¼returnå‡ºå»ã€‚

---

### æ¡ˆåˆ—æ“ä½œ

ä¸‹é¢è¿˜ä»¥Profileç»„ä»¶æ¡ˆä¾‹ï¼Œå±•ç¤ºContextè¯­æ³•å®ç°çš„è·¨ç»„ä»¶é€šè®¯ã€‚

ä½¿ç”¨ContextAPIå®ç°è·¨ç»„ä»¶é€šè®¯ï¼ŒæˆåŠŸè§£å†³äº†å¤šå±‚ç»„ä»¶åµŒå¥—æ—¶ï¼šä¸­é—´ç»„ä»¶è¢«è¿«ä¼ é€’æ•°æ®çš„é—®é¢˜ã€‚

**classè®¢é˜…ç»„ä»¶**

```
//å®šä¹‰Contextå¯¹è±¡ï¼Œå¹¶èµ‹äºˆé»˜è®¤å€¼
const UserContext = React.createContext({
  nickName: "é»˜è®¤åç§°",
  level: "é»˜è®¤ç­‰çº§",
});

export default class App extends Component {
  constructor() {
    super();
    this.title = "Ashuntefannao";
    this.state = {
      nickName: "Ashun",
      level: 99,
    };
  }
  render() {
    return (
      <div id="main">
        <h2 onClick={this.change.bind(this)}>{this.title}</h2>
        {/* ä½¿ç”¨Context.Providerç»„ä»¶ï¼Œé…ç½®ä¼ é€’çš„æ•°æ®ï¼Œå¹¶å°†è®¢é˜…ç»„ä»¶åŒ…è£¹*/}
        <UserContext.Provider
          value={{ nickName: this.state.nickName, level: this.state.level }}
        >
          <Profile />
        </UserContext.Provider>
      </div>
    );
  }
  change() {
    let newState = { nickName: "æ›´æ¢åç§°ï¼šSHUN", level: "98" };
    this.setState(newState);
  }
}

function Profile() {
  return (
    <div id="profile">
      <header>profile</header>
      <ProfileContent/>
    </div>
  );
}

class ProfileContent extends Component {
  static contextType = UserContext;		//è®¢é˜…ç»„ä»¶é…ç½®contextType,è®¢é˜…ç›®æ ‡Contextå¯¹è±¡
  render() {
    return (
      <div className="ProfileContent">
        <ul>
          <li>{this.context.nickName}</li>	{/*	é€šè¿‡this.contextè·å–æ•°æ®*/}
          <li>{this.context.level}</li>
        </ul>
      </div>
    );
  }
}
```

å€¼å¾—æ³¨æ„çš„æ˜¯ï¼š

â€‹	å¦‚æœå°†`Profile`è®¢é˜…ç»„ä»¶æ”¾åœ¨`UserContext.Provider`ç»„ä»¶å¤–éƒ¨ï¼Œåˆ™åœ¨æ”€å±‚å¯»æ‰¾contextæ—¶ï¼Œå°†ä¸èƒ½æ‰¾åˆ°`UserContext`å…±äº«çš„å˜é‡ï¼Œæ­¤æ—¶å°†ä¼šåº”ç”¨Contextå¯¹è±¡åˆ›å»ºæ—¶ä¼ å…¥çš„é»˜è®¤å€¼ã€‚

> è¯¥é—®é¢˜åœ¨ä¸Šæ–‡ï¼ˆåˆ›å»ºContextå¯¹è±¡ï¼‰ä¸­å·²ç»æåŠè¿‡äº†ï¼šç»„ä»¶åœ¨æ”€å±‚çº§æŸ¥æ‰¾çš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœç›´è‡³æœ€é¡¶çº§éƒ½æ²¡æœ‰æ‰¾åˆ°å¯¹åº”çš„`Provider`ï¼Œé‚£ä¹ˆå°†ä½¿ç”¨é»˜è®¤å€¼ã€‚

**å‡½æ•°è®¢é˜…ç»„ä»¶**

```
/* å‡½æ•°è®¢é˜…ç»„ä»¶ */
function ProfileContent(props) {
  return (
    <UserContext.Consumer>
      {
        (context)=>{
          return (
            <div className="ProfileContent">
              <ul>
                <li>{context.nickName}</li>
                <li>{context.level}</li>
              </ul>
            </div>
          )
        }
      }
    </UserContext.Consumer>
  );
}
```

## ä½¿ç”¨å¤šä¸ªContext

ä¸Šæ–‡ï¼ˆè¿‡ç¨‹æ¢³ç†ï¼‰ä¸­æ‰€è®²çš„å†…å®¹ï¼Œåªæ˜¯ï¼šä½¿ç”¨ä¸€ä¸ªContextæ—¶çš„æƒ…å†µã€‚ä¸è®ºæ˜¯classç»„ä»¶ï¼Œè¿˜æ˜¯å‡½æ•°ç»„ä»¶ï¼Œå‰ä¸¤æ­¥éƒ½æ˜¯ä¸€æ ·çš„ï¼š

1. `Ctx=React.createContext()`
2. `<Ctx.Provider value={obj}></â€¦>`

* å¯¹äºclassç»„ä»¶ï¼Œåœ¨è®¢é˜…æ—¶ï¼Œåªéœ€è¦è®¾ç½®é™æ€å±æ€§`contextType`è®¢é˜…ç›®æ ‡Contextå³å¯ï¼Œ**ä½†åªèƒ½è®¢é˜…ä¸€ä¸ªContext**ã€‚

* è€Œå¯¹äºå‡½æ•°ç»„ä»¶ï¼Œä¸èƒ½å¤Ÿåƒclassç»„ä»¶ä¸€æ ·è®¾ç½®é™æ€å±æ€§è¿›è¡Œè®¢é˜…ï¼Œåªèƒ½ä½¿ç”¨`Ctx.Consumer`ç»„ä»¶çš„å½¢å¼ï¼Œè¿›è¡Œè®¢é˜…ã€‚

è€Œä¹‹å‰æˆ‘ä»¬å·²ç»è¯´è¿‡äº†ï¼Œ`Ctx.Consumer`æœ¬èº«çš„ä½œç”¨å°±æ˜¯å¤„ç†**ä½¿ç”¨å¤šä¸ªContext**æƒ…å†µçš„ã€‚ä¹Ÿæ˜¯æˆ‘ä»¬ä¸‹æ–‡è¦è®²çš„ã€‚

å…¶å®`Ctx.Consumer`çš„ä½¿ç”¨æ–¹å¼ï¼Œæˆ‘ä»¬å·²ç»åœ¨å‡½æ•°è®¢é˜…ç»„ä»¶ä¸­è®²è¿‡äº†ï¼Œé‚£ä¹ˆå¯¹äºä½¿ç”¨å¤šä¸ªContextçš„æƒ…å†µï¼Œè§£å†³è¿‡ç¨‹å¾ˆç®€å•ï¼š**å°±æ˜¯è¿›è¡Œ Ctx.Consumer çš„åµŒå¥—**ã€‚

ä¸‹é¢ç»§ç»­ä»¥ä¸Šæ–‡ä¸­çš„æ¡ˆä¾‹è¿›è¡Œæ‰©å……ï¼Œç°åœ¨æˆ‘ä¸ä»…ä»…è¦ä½¿ç”¨`UserContext`ï¼Œè¿˜è¦ä½¿ç”¨`TestColorContext`ã€‚

```
//åˆ›å»ºContextå¯¹è±¡
const UserContext = React.createContext({
  nickName: "é»˜è®¤åç§°",
  level: "é»˜è®¤ç­‰çº§",
});
//åµŒå¥—çš„Contextå¯¹è±¡
const TestColorContext=React.createContext({
  color:"red"
})

export default class App extends Component {
  constructor() {
    super();
    this.title = "Ashuntefannao";
    this.state = {
      nickName: "Ashun",
      level: 99,
    };
  }
  render() {
    return (
      <div id="main">
        <h2 onClick={this.change.bind(this)}>{this.title}</h2>
        {/* ä½¿ç”¨Context.Providerç»„ä»¶ï¼Œå°†è®¢é˜…ç»„ä»¶åŒ…è£¹*/}
        <UserContext.Provider
          value={{ nickName: this.state.nickName, level: this.state.level }}
        >
          <TestColorContext.Provider value={{color:"red"}}>
            <Profile />
          </TestColorContext.Provider>
        </UserContext.Provider>
      </div>
    );
  }
  change() {
    let newState = { nickName: "æ›´æ¢åç§°ï¼šSHUN", level: "98" };
    this.setState(newState);
  }
}

function Profile() {
  return (
    <div id="profile">
      <header>profile</header>
      <ProfileContent />
    </div>
  );
}

/* å‡½æ•°è®¢é˜…ç»„ä»¶ */
function ProfileContent(props) {
  return (
    <UserContext.Consumer>		{/* æœ€å¤–å±‚ï¼Œä½¿ç”¨UserContext.Consumer */}
    {
      (user)=>(
        <TestColorContext.Consumer>		{/* å†…å±‚ï¼ŒTestColorContext.Consumer */}
          {
            (theme)=>
             (
              <div className="ProfileContent">
                <ul style={{color:theme.color}}>	{/* åˆ†åˆ«ä½¿ç”¨å¯¹åº”çš„å‡½æ•°å‚æ•°è¿›è¡Œæ•°æ®è®¿é—® */}
                  <li>{user.nickName}</li>    
                  <li>{user.level}</li>
                </ul>
              </div>
             )

          }
        </TestColorContext.Consumer>
      )
    }
    </UserContext.Consumer>
  );
}
```

å¯¹äºç±»ç»„ä»¶æ¥è¯´ï¼Œä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œåªä¸è¿‡æ­¤æ—¶ï¼šä¹Ÿå°±ä¸éœ€è¦ä½¿ç”¨`contextType`è®¢é˜…å•ä¸€Contextäº†ã€‚

```
/*  classè®¢é˜…ç»„ä»¶ */
class ProfileContent extends Component {
  render() {
    return (
      <UserContext.Consumer>			
      {(user)=>(
        <TestColorContext.Consumer>		
          {
            (theme)=>
             (
              <div className="ProfileContent">
                <ul style={{color:theme.color}}>	
                  <li>{user.nickName}</li>    
                  <li>{user.level}</li>
                </ul>
              </div>
             )

          }
        </TestColorContext.Consumer>
      )
      }
      </UserContext.Consumer>
    );
  }
}
```

## æ€»ç»“

**å«ä¹‰åŠç”¨å¤„ï¼š**

ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼šç”¨äºä¿¡æ¯å…±äº«ï¼Œå®ç°è·¨å±‚çº§ä¼ é€’å€¼

**Context API**

1. `Ctx=React.createContext()`
2. `Ctx.Provider`
3. `Class.contextType` 
4. `Ctx.Consumer`

**Context çš„ä½¿ç”¨ï¼š**

1. åªæœ‰**ç±»ç»„ä»¶**å¯ä»¥ä½¿ç”¨`contextType`è®¢é˜…**ä¸€ä¸ªContext**
2. å‡½æ•°ç»„ä»¶ä¸å¯ä½¿ç”¨contextTypeï¼Œåªèƒ½ä½¿ç”¨`Ctx.Consumer`
3. Consumerå¯ä»¥åº”ç”¨äºç±»ç»„ä»¶ **å’Œ** å‡½æ•°ç»„ä»¶ï¼Œ Consumerå¯ä»¥ä½¿ç”¨ **å¤šä¸ª** contextï¼Œä½†æ˜¯contextTypeä¸è¡Œ

æ›´å¤šContextçš„ä½¿ç”¨è§„åˆ™è¯·å‚è€ƒğŸ“‘[å®˜æ–¹æ–‡æ¡£](https://zh-hans.reactjs.org/docs/context.html#legacy-api)ã€‚

---

# äº‹ä»¶æ€»çº¿

å‰é¢ä¸€ç›´åœ¨è®²è§£å¤šå±‚çº§ç»„ä»¶åµŒå¥—æ—¶ï¼Œç»„ä»¶ä¹‹é—´çš„æ²Ÿé€šåº”è¯¥æ€ä¹ˆè§£å†³ï¼Œä½†æ˜¯å¦‚æœå…„å¼Ÿç»„ä»¶ä¹‹é—´è¿›è¡Œæ²Ÿé€šï¼Œä¸€èˆ¬æˆ‘ä»¬ä¼šä½¿ç”¨`äº‹ä»¶æ€»çº¿`

åœ¨Vueä¸­æˆ‘ä»¬å¯ä»¥é€šè¿‡`äº‹ä»¶æ€»çº¿`ï¼Œè®©å…¨å±€ç»„ä»¶ä¹‹é—´è¿›è¡Œé€šè®¯ã€‚åœ¨Reactä¸­æˆ‘ä»¬ä¹Ÿå¯ä»¥å®ç°ï¼Œè¿™é‡Œè¦ä¾èµ–ä¸€ä¸ªå¸¸ç”¨çš„æ’ä»¶`events`ã€‚

ä½¿ç”¨æ­¥éª¤ï¼š

1. ä¸‹è½½ï¼š

   ```
   yarn add events
   ```

2. å¼•å…¥`EventEmitter`,å¹¶å®ä¾‹åŒ–ä¸ºå¯¹è±¡

   ```
   import { EventEmitter } from "events"
   const EventBus = new EventEmitter();
   ```

3. ä½¿ç”¨å…·ä½“çš„APIè¿›è¡Œç»„ä»¶ä¹‹é—´çš„é€šè®¯ï¼Œä¸‹é¢é€šè¿‡ä¸¤ä¸ªæ¡ˆä¾‹è®²è§£

## æ·±å±‚ç»„ä»¶åµŒå¥—

ä¸‹ä¾‹ä»£ç ä¸­ï¼Œç»„ä»¶å±‚çº§å…³ç³»ä¸ºï¼šApp->Content->Articleï¼Œç°åœ¨ï¼Œè¦è®©Articleåˆ©ç”¨äº‹ä»¶æ€»çº¿å‘å°„äº‹ä»¶ï¼Œå¹¶åœ¨Appç»„ä»¶ä¸­è¿›è¡Œæ¥æ”¶ã€‚

```
import React, { Component } from "react";
import { EventEmitter } from "events";

const EventBus = new EventEmitter();
export default class App extends Component {
  constructor() {
    super();
    this.state = {};
  }
  componentDidMount() {
    EventBus.addListener("emitEvent", this.emitEvent);
  }
  componentWillUnmount() {
    EventBus.removeListener("emitEvent", this.emitEvent);
  }
  emitEvent(...args) {
    console.log(args);
  }
  render() {
    return (
      <div id="max">
        <h2>Application</h2>
        <Content />
      </div>
    );
  }
}

class Content extends Component {
  render() {
    return (
      <div id="main">
        <h3>Main</h3>
        <Article />
      </div>
    );
  }
}
class Article extends Component {
  constructor() {
    super();
    this.state = {
      list: ["æ–°é—»èµ„è®¯", "å¨±ä¹æ½®æµ", "æ—¶å°šç©¿æ­", "ç§‘æŠ€å‰æ²¿"],
    };
  }
  render() {
    return (
      <div className="article">
        <ul>
          {this.state.list.map((v) => {
            return <li key={v}>{v}</li>;
          })}
        </ul>
        <button onClick={this.emitEvent.bind(this)}>emitEvent</button>
      </div>
    );
  }
  emitEvent() {
    EventBus.emit("emitEvent", "Hello App Component", "my name is Article");
  }
}
```

### äº‹ä»¶çš„å‘å°„

é€šè¿‡`EventEmitter`å®ä¾‹å¯¹è±¡çš„`emit`æ–¹æ³•è¿›è¡Œäº‹ä»¶çš„å‘å°„ï¼Œç”¨æ³•ä¸Vueä¸­ç›¸åŒï¼Œå…¶æ¥æ”¶**ä¸¤ç±»**å‚æ•°

* å‚æ•°1ï¼šäº‹ä»¶åç§°
* å‚æ•°2~nï¼šä¼ é€’çš„å˜é‡

```
emitEvent() {
    EventBus.emit("emitEvent", "Hello App Component", "my name is Article");
}
```

### äº‹ä»¶çš„ç›‘å¬/ç§»é™¤

#### äº‹ä»¶ç›‘å¬

é€šè¿‡`EventEmitter`å®ä¾‹å¯¹è±¡çš„`addListener`æ–¹æ³•è¿›è¡Œäº‹ä»¶çš„ç›‘å¬ï¼Œç”¨æ³•ä¸Vueä¸­çš„`$on`ç›¸åŒï¼Œå…¶æ¥æ”¶**ä¸¤ä¸ª**å‚æ•°

* å‚æ•°1ï¼šäº‹ä»¶åç§°
* å‚æ•°2ï¼šäº‹ä»¶å¤„ç†å‡½æ•°

#### äº‹ä»¶ç§»é™¤

é€šè¿‡`EventEmitter`å®ä¾‹å¯¹è±¡çš„`addListener`æ–¹æ³•è¿›è¡Œäº‹ä»¶çš„ç›‘å¬ï¼Œç”¨æ³•ä¸Vueä¸­çš„`$off`ç›¸åŒï¼Œå…¶ä¹Ÿæ¥æ”¶**ä¸¤ä¸ª**å‚æ•°

* å‚æ•°1ï¼šäº‹ä»¶åç§°
* å‚æ•°2ï¼š**å¯¹åº”çš„äº‹ä»¶å¤„ç†å‡½æ•°**

```
componentDidMount() {
  EventBus.addListener("emitEvent", this.emitEvent);
}
componentWillUnmount() {
  EventBus.removeListener("emitEvent", this.emitEvent);
}
emitEvent(...args) {
  console.log(args);
}
```

### æ³¨æ„ç‚¹ï¼š

é€šè¿‡ä¸Šè¿°ä»£ç ï¼Œæˆ‘ä»¬ä¹Ÿè§‚å¯Ÿåˆ°äº†ä¸€äº›ç»†èŠ‚ï¼š

1. äº‹ä»¶ç›‘å¬å·¥ä½œåœ¨`componentDidMount`ä¸­å®Œæˆ
2. äº‹ä»¶ç§»é™¤å·¥ä½œåœ¨`componentWillUnmount`ä¸­å®Œæˆ
3. å°†äº‹ä»¶å¤„ç†å‡½æ•°å•ç‹¬å®šä¹‰å‡ºæ¥ã€‚

**åŸå› **ï¼š

â€‹	ä¹‹æ‰€ä»¥åœ¨`componentDidMount`ä¸­å®Œæˆäº‹ä»¶ç›‘å¬ï¼Œæ˜¯å› ä¸ºç»„ä»¶æŒ‚è½½å®Œæ¯•ï¼Œæˆ‘ä»¬æ‰èƒ½å¤Ÿè®¿é—®DOMçš„ç»“æ„ï¼Œåœ¨å…¶ä¸­å¯ä»¥é€šè¿‡äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œå¯¹DOMç»“æ„è¿›è¡Œä¸€äº›æ“ä½œã€‚

â€‹	åœ¨`componentWillUnmount`ä¸­å®Œæˆäº‹ä»¶çš„ç§»é™¤ï¼Œè¿™ä¸ªä¹Ÿå¾ˆå¥½ç†è§£ï¼Œæ˜¯ä¸ºäº†**æ€§èƒ½ä¼˜åŒ–**ï¼Œåœ¨ç»„ä»¶å¸è½½å‰ï¼Œå°†æ‰€æœ‰ç›‘å¬çš„äº‹ä»¶éƒ½è¦ä¾æ¬¡ç§»é™¤ï¼Œé¿å…è¿™äº›æ— ç”¨çš„äº‹ä»¶ç›‘å¬ã€‚

â€‹	å°†äº‹ä»¶å¤„ç†å‡½æ•°å•ç‹¬å®šä¹‰å‡ºæ¥ï¼šä¸åŸç”Ÿ`removeEventListener`çš„ä½¿ç”¨ç›¸åŒã€‚ç”±äºè¦å®Œæˆäº‹ä»¶çš„ç§»é™¤ï¼Œæˆ‘ä»¬è¦ä¼ å…¥ç›¸åŒçš„`å‡½æ•°å¼•å€`ï¼Œæ‰èƒ½å¤Ÿç§»é™¤å¯¹åº”çš„äº‹ä»¶å¤„ç†ç¨‹åºã€‚

## å…„å¼Ÿç»„ä»¶é€šè®¯

å…„å¼Ÿç»„ä»¶ä¹‹é—´çš„é€šè®¯ï¼ŒåŒæ ·å¯ä»¥ä½¿ç”¨äº‹ä»¶æ€»çº¿å®Œæˆç»„ä»¶é€šè®¯ã€‚

ä¾‹å¦‚ä¸‹é¢æ¡ˆä¾‹ï¼š

AppåŒ…å«ä¸¤ä¸ªå­ç»„ä»¶ï¼š`Child1`ã€`Child2`ï¼Œç°åœ¨è®©è¿™ä¸¤ä¸ªå…„å¼Ÿç»„ä»¶ä¹‹é—´å®ç°é€šè®¯ï¼Œç‚¹å‡»æŒ‰é’®ï¼šå°†Child2ä¸­çš„æ•°æ®ä¼ é€’åˆ°Child1,å¹¶è¿›è¡Œå±•ç¤ºã€‚

<img src="1-è·¨ç»„ä»¶é€šè®¯.assets/001.png" alt="001" style="zoom:80%;" />

<img src="1-è·¨ç»„ä»¶é€šè®¯.assets/002.png" alt="002" style="zoom:70%;" />

```
export default class App extends Component {
  constructor() {
    super();
    this.state = {
      title: "Ashuntefannao",
    };
  }
  render() {
    return (
      <div id="max">
        <h2>{this.state.title}</h2>
        <Child1 />
        <Child2 />
      </div>
    );
  }
}
class Child1 extends Component {
  constructor() {
    super();
    this.state = {
      title: "æˆ‘æ˜¯Child1",
      list: null,
    };
  }
  componentDidMount() {
    EventBus.addListener("emitEvent", this.emitEvent.bind(this));
  }
  componentWillUnmount() {
    EventBus.removeListener("emitEvent", this.emitEvent);
  }
  emitEvent(list) {
    console.log(list);
    this.setState({ list });
  }
  render() {
    return (
      <div id="child1">
        <h3>{this.state.title}</h3>
        <ul>
          {this.state.list &&
            this.state.list.map((item) => {
              return <li key={item}>{item}</li>;
            })}
        </ul>
      </div>
    );
  }
}
class Child2 extends Component {
  constructor() {
    super();
    this.state = {
      title: "æˆ‘æ˜¯Child2",
      list: ["æ–°é—»èµ„è®¯", "å¨±ä¹æ½®æµ", "æ—¶å°šç©¿æ­", "ç§‘æŠ€å‰æ²¿"],
    };
  }
  render() {
    return (
      <div id="child2">
        <h3>{this.state.title}</h3>
        <button onClick={this.emitEvent.bind(this)}>
          ç‚¹å‡»å‘Child1å‘é€äº‹ä»¶
        </button>
      </div>
    );
  }
  emitEvent() {
    EventBus.emit("emitEvent", [...this.state.list]);
  }
}
```

