## Fragment

`Fragment`æ˜¯Vueå†…éƒ¨åˆ›å»ºçš„ä¸€ä¸ªç»„ä»¶ï¼Œä¸ç”¨æˆ‘ä»¬æ‰‹åŠ¨å®šä¹‰ï¼Œç”¨äºè§£å†³Vue2çš„ç»„ä»¶ä¸­å¿…é¡»æœ‰ä¸€ä¸ª`rootElement`çš„é—®é¢˜

- åœ¨Vue2ä¸­: ç»„ä»¶å¿…é¡»æœ‰ä¸€ä¸ªæ ¹å…ƒç´ 
- åœ¨Vue3ä¸­: ç»„ä»¶å¯ä»¥è®¾ç½®å¤šä¸ªæ ¹å…ƒç´ , å†…éƒ¨ä¼šå°†å¤šä¸ªæ ‡ç­¾åŒ…å«åœ¨ä¸€ä¸ª`Fragment`**è™šæ‹Ÿå…ƒç´ **ä¸­
- å¥½å¤„: å‡å°‘æ ‡ç­¾å±‚çº§, å‡å°å†…å­˜å ç”¨

```
<template>
  <p>
    åœ¨Vue3ä¸­: ç»„ä»¶å¯ä»¥è®¾ç½®å¤šä¸ªæ ¹å…ƒç´ ,
    å†…éƒ¨ä¼šå°†å¤šä¸ªæ ‡ç­¾åŒ…å«åœ¨ä¸€ä¸ªFragmentè™šæ‹Ÿå…ƒç´ ä¸­
  </p>
  <h2>å¯åœ¨Vue.js devtoolsä¸­æŸ¥çœ‹</h2>
</template>
```

<img src="æ–°ç»„ä»¶.assets/001.png" alt="001" style="zoom:80%;" />

## Teleport

Teleport (ä¼ é€)â€”â€”æ˜¯ä¸€ç§èƒ½å¤Ÿå°†<strong style="color:#f39c12">ç›®æ ‡htmlç»“æ„</strong>ç§»åŠ¨åˆ°æŒ‡å®šä½ç½®çš„ç»„ä»¶ã€‚

* ä½¿ç”¨`teleport`æ ‡ç­¾åŒ…è£¹`ç›®æ ‡htmlç»“æ„`
* ä¸º`teleport`è®¾ç½®`to`å±æ€§ï¼Œä»£è¡¨ç§»åŠ¨çš„ç›®æ ‡ä½ç½®
  * å…¶å€¼ä¸º`cssé€‰æ‹©å™¨`ï¼Œå°±èƒ½ç§»åŠ¨åˆ°æŒ‡å®šæ ‡ç­¾å†…éƒ¨çš„æœ«å°¾
* è‹¥`teleport`åŒ…è£¹çš„å†…å®¹ï¼ŒåŒ…å«`ç»„ä»¶`ï¼Œè™½ç„¶ç»„ä»¶çš„ä½ç½®ä¼šè¿›è¡Œç§»åŠ¨ï¼Œä½†ä¸ä¼šå½±å“ç»„ä»¶æ³¨å†Œæ—¶çš„çˆ¶å­å…³ç³»ï¼Œä¾æ—§èƒ½ä»åŸçˆ¶ç»„ä»¶æ¥æ”¶props

### è­¦ç¤ºæ¡†æ¡ˆä¾‹ä½“éªŒï¼š

é€šè¿‡å°è£…è­¦ç¤ºæ¡†ç»„ä»¶ï¼Œæ¥ä½“éªŒ`teleport`ï¼Œå…¶ä¸­ç»„ä»¶çš„åµŒå¥—å…³ç³»ä¸ºï¼š

* App
  * Child
    * Grandson
      * Alert

è¦æ±‚ï¼šAlertèƒ½è¢«ä»»æ„ç»„ä»¶ä½¿ç”¨ï¼Œä¸”å¼¹å‡ºæ—¶æœ‰maské®ç½©å±‚ï¼Œå°†æ•´ä¸ªåº”ç”¨è¿›è¡Œé®ç½©ã€‚

#### æœ€ç»ˆä»£ç 

App.vue

```
<template>
  <div id="main">
    <h2>{{ title }}</h2>
    <child />
  </div>
</template>
<script>
  import { defineComponent, reactive, toRefs } from "vue";
  import Child from "./Child.vue";
  export default defineComponent({
    name: "App",
    components: { Child },
    setup() {
      const state = reactive({
        title: "Appç»„ä»¶",
      });
      return {
        ...toRefs(state),
      };
    },
  });
</script>
<style>
  * {
    margin: 0;
    padding: 0;
  }
  body {
    width: 100vw;
    height: 100vh;
    background: #bbb;
  }
  #main {
    color: white;
    background: #1abc9c;
  }
</style>
```

Child.vue

```
<template>
  <div id="Child">
    <h2>{{ title }}</h2>
    <grandson />
  </div>
</template>
<script>
  import { defineComponent, reactive, toRefs } from "vue";
  import Grandson from "./Grandson.vue";
  export default defineComponent({
    name: "ChildCPN",
    components: {
      Grandson,
    },
    setup() {
      const state = reactive({
        title: "Childç»„ä»¶",
      });
      return {
        ...toRefs(state),
      };
    },
  });
</script>
<style scoped>
  #Child {
    margin: 5px;
    color: white;
    background: #2980b9;
  }
</style>
```

Grandson.vue

```
<template>
  <div id="Grandson">
    <h2>{{ title }}</h2>
    <alert :message="message" />
  </div>
</template>
<script>
  import { defineComponent, reactive, toRefs } from "vue";
  import Alert from "./Alert.vue";
  export default defineComponent({
    name: "GrandsonCPN",
    components: { Alert },
    setup() {
      const state = reactive({
        title: "Grandsonç»„ä»¶",
        message: "çˆ¶ç»„ä»¶ä¼ å…¥çš„massage",
      });

      return {
        ...toRefs(state),
      };
    },
  });
</script>
<style scoped>
  #Grandson {
    margin: 8px;
    color: white;
    background: #e74c3c;
  }
</style>
```

Alert.vue

```
<template>
  <div id="Alert">
    <button @click="changeShow">isAlert</button>
    <teleport to="body">
      <div id="AlertMask" v-show="isShow">
        <div class="content">
          <button @click="changeShow">X</button>
          <h2>{{ title }}</h2>
          <p>{{ message }}</p>
        </div>
      </div>
    </teleport>
  </div>
</template>
<script>
  import { defineComponent, reactive, toRefs } from "vue";

  export default defineComponent({
    name: "AlertCPN",
    props: {
      message: {
        type: String,
        default: "Message",
      },
    },
    setup(props) {
      const state = reactive({
        title: "Alertç»„ä»¶",
        isShow: false,
      });
      const changeShow = () => {
        state.isShow = !state.isShow;
      };
      return {
        ...toRefs(state),
        changeShow,
      };
    },
  });
</script>
<style scoped>
  #Alert {
    color: white;
  }
  #AlertMask {
    position: absolute;
    top: 0;
    bottom: 0;
    left: 0;
    right: 0;
    background-color: rgba(0, 0, 0, 0.3);
    backdrop-filter: blur(5px);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
  }

  .content {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    background-color: #9b59b6;
    border-radius: 8px;
    padding: 8px;
  }
</style>
```

#### ä½¿ç”¨teleport

ä¸ºäº†èƒ½è®©`mask`é®æŒ¡ä½æ•´ä¸ªåº”ç”¨ï¼Œä½¿ç”¨`position`ç»“åˆ`top/bottom/left/right`å°†maskæ’‘å¼€ã€‚

ä½†å¦‚æœAlertç»„ä»¶çš„ä½¿ç”¨è€…(çˆ¶ç»„ä»¶)ï¼Œè®¾ç½®äº†`ç›¸å¯¹å®šä½`,å¹¶ä¸”å…¶å®½é«˜æ²¡æœ‰å æ»¡æ•´ä¸ªå±å¹•ï¼Œåˆ™maskå°±ä¸èƒ½é®æŒ¡æ•´ä¸ªåº”ç”¨ã€‚

å¹¶ä¸”è‹¥çˆ¶ç»„ä»¶è¿˜è®¾ç½®äº†overflowï¼Œæƒ…å†µä¼šæ›´åŠ ç³Ÿç³•ã€‚

ä¾‹å¦‚å°†ä¸Šè¿°ç»„ä»¶ä»£ç åšå‡ºä»¥ä¸‹æ›´æ”¹ï¼ŒAlertç»„ä»¶çš„å±•ç¤ºä¼šå¾ˆç³Ÿï¼š

Grandson.vue

```
<style scoped>
  #Grandson {
    â€¦â€¦
    position: relative;
    overflow: hidden;
  }
</style>
```

Alert.vue

```
å»é™¤teleportç»„ä»¶
```

<img src="æ–°ç»„ä»¶.assets/002.gif" alt="002" style="zoom:80%;" />

å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨`teleport`ï¼Œå°†`mask`éƒ¨åˆ†ç§»åŠ¨åˆ°`body`ä¸­ï¼Œæ­¤æ—¶positionå°±æ˜¯ç›¸å¯¹äºæ•´ä¸ªbodyè¿›è¡Œå®šä½çš„ï¼š

<img src="æ–°ç»„ä»¶.assets/003.gif" alt="003" style="zoom:80%;" />

<img src="æ–°ç»„ä»¶.assets/004.png" alt="004" style="zoom:80%;" />

#### teleportåŒ…è£¹ç»„ä»¶

è‹¥`teleport`åŒ…è£¹çš„å†…å®¹ï¼ŒåŒ…å«`ç»„ä»¶`ï¼Œè™½ç„¶ç»„ä»¶çš„ä½ç½®ä¼šè¿›è¡Œç§»åŠ¨ï¼Œä½†ä¸ä¼šå½±å“ç»„ä»¶æ³¨å†Œæ—¶çš„çˆ¶å­å…³ç³»ï¼Œä¾æ—§èƒ½ä»åŸçˆ¶ç»„ä»¶æ¥æ”¶props

ä¾‹å¦‚åœ¨Grandson.vueä¸­å°†æ•´ä¸ªalertç»„ä»¶è¿›è¡Œç§»åŠ¨ï¼Œalertç»„ä»¶è™½ç„¶è¢«ç§»åŠ¨åˆ°äº†å¤–éƒ¨ï¼Œä½†ç‚¹å‡»æŒ‰é’®åï¼Œä¾æ—§èƒ½å±•ç¤ºGrandsonä¼ å…¥çš„props

```
<template>
  <div id="Grandson">
    <h2>{{ title }}</h2>
    <teleport to="body">
    	<alert :message="message" />
    </teleport>
  </div>
</template>
```

<img src="æ–°ç»„ä»¶.assets/005.gif" alt="005" style="zoom:80%;" />

## Suspense

`Suspense`(æ‚¬å¿µ)ï¼šç­‰å¾…å¼‚æ­¥ç»„ä»¶çš„è¿‡ç¨‹ä¸­æ¸²æŸ“ä¸€äº›é¢å¤–å†…å®¹ï¼Œè®©ç”¨æˆ·æœ‰æ›´å¥½çš„ä½“éªŒã€‚

å…ˆç®€å•æ€»ç»“ä¸€ä¸‹ä½¿ç”¨æ­¥éª¤ï¼š

- å¼‚æ­¥å¼•å…¥ç»„ä»¶

  1. ä½¿ç”¨`defineAsyncComponent`ï¼Œå¼‚æ­¥å¼•å…¥
  2. åœ¨å¼‚æ­¥ç»„ä»¶ä¸­è¿”å›`Promise`ï¼Œå¼‚æ­¥è¿”å›ç»„ä»¶çš„stateï¼Œæ­£å¸¸å¼•å…¥

- ä½¿ç”¨```Suspense```åŒ…è£¹ç»„ä»¶ï¼Œå¹¶é…ç½®å¥½`default` ä¸ `fallback`

  - defaultï¼šå¼‚æ­¥åŠ è½½çš„ç»„ä»¶
  - fallback(é€€è·¯)ï¼šç­‰å¾…å¼‚æ­¥ç»„ä»¶åŠ è½½æ—¶ï¼Œæ¸²æŸ“çš„å†…å®¹

  ```
  <Suspense>
    <template v-slot:default>
      <Child/>
    </template>
    <template v-slot:fallback>
      <h3>åŠ è½½ä¸­.....</h3>
    </template>
  </Suspense>
  ```

## å¼‚æ­¥å¼•å…¥ç»„ä»¶

æˆ‘ä»¬çŸ¥é“ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼šåªæœ‰å½“åä»£ç»„ä»¶æŒ‚è½½å®Œæ¯•åï¼Œç¥–å…ˆç»„ä»¶æ‰èƒ½å¤Ÿè¢«æŒ‚è½½åˆ°é¡µé¢ï¼Œå› æ­¤å‘ˆç°çš„æ•ˆæœæ˜¯çˆ¶å­ç»„ä»¶ä¸€åŒå‡ºç°ã€‚

æˆ‘ä»¬å¯ä»¥é€šè¿‡æ§åˆ¶å°ï¼Œå°†ç½‘ç»œè°ƒå·®ï¼Œæ¥è§‚å¯ŸåŠ è½½çš„è¿™ä¸ªè¿‡ç¨‹ï¼š

<img src="æ–°ç»„ä»¶.assets/006.png" alt="006" style="zoom:80%;" />

å¯ä»¥è§‚å¯Ÿåˆ°ï¼Œçˆ¶å­ç»„ä»¶æ˜¯ä¸€èµ·å‡ºç°çš„

<img src="æ–°ç»„ä»¶.assets/007.gif" alt="007" style="zoom:80%;" />

ä½†æœ‰æ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›å­ç»„ä»¶èƒ½å¤Ÿ`å¼‚æ­¥åŠ è½½`ï¼Œå¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼å®ç°ğŸ‘‡

1. ä½¿ç”¨`defineAsyncComponent`ï¼Œå¼‚æ­¥å¼•å…¥
2. åœ¨å¼‚æ­¥ç»„ä»¶ä¸­è¿”å›`Promise`ï¼Œå¼‚æ­¥è¿”å›ç»„ä»¶çš„stateï¼Œæ­£å¸¸å¼•å…¥

### defineAsyncComponent

åœ¨çˆ¶ç»„ä»¶ä¸­ï¼Œä½¿ç”¨`defineAsyncComponent`åŠŸèƒ½å‡½æ•°ï¼Œå¼‚æ­¥å¼•å…¥ç»„ä»¶

```
defineAsyncComponent(() => import("pathName"))
```

```
<script>
  import { defineAsyncComponent, â€¦â€¦ } from "vue";
  const Child = defineAsyncComponent(() => import("./Child.vue"));
  export default defineComponent({
    name: "App",
    components: {
      Child,
    },
    setup() {
      const state = reactive({
        title: "Appç»„ä»¶",
      });
      return {
        ...toRefs(state),
      };
    },
  });
</script>
```

æ­¤æ—¶å°±å¯è§‚å¯Ÿåˆ°ï¼ŒChildæ˜¯å¼‚æ­¥å¼•å…¥ï¼ŒAppç»„ä»¶ä¼˜å…ˆå‘ˆç°

<img src="æ–°ç»„ä»¶.assets/008.gif" alt="008" style="zoom:80%;" />

### Promiseå¼‚æ­¥è¿”å›çŠ¶æ€

å¦‚æœæˆ‘ä»¬å¸Œæœ›æŸä¸ªç»„ä»¶å˜ä¸º`å¼‚æ­¥ç»„ä»¶`ï¼Œå¯ä»¥åœ¨`setup`ä¸­è¿”å›Promiseï¼Œç”¨äºå¼‚æ­¥è¿”å›stateã€‚åŒæ ·èƒ½å¤Ÿè¾¾åˆ°å¼‚æ­¥æ•ˆæœã€‚

Child.vue:

```
<script>
  import { defineComponent, reactive, toRefs } from "vue";
  export default defineComponent({
    name: "ChildCPN",
    setup() {
      const state = reactive({
        title: "Childç»„ä»¶",
      });
      return new Promise((resolve, reject) => {
       setTimeout(() => {
         resolve({ ...toRefs(state) });
       }, 3000);
      });
    },
  });
</script>
```

App.vue

ç”±äºåœ¨Childç»„ä»¶ä¸­å¼‚æ­¥è¿”å›stateï¼ŒChildæœ¬èº«æ˜¯å¼‚æ­¥ç»„ä»¶ï¼Œæ‰€ä»¥åœ¨Appä¸­æ­£å¸¸å¼•å…¥å³å¯

```
import Child from "./Child.vue";
â€¦â€¦
```

æ•ˆæœï¼šä¸‰ç§’åï¼ŒChildå‡ºç°

<img src="æ–°ç»„ä»¶.assets/009.gif" alt="009" style="zoom:80%;" />

## æ¡ˆä¾‹ä½“éªŒ

* Childå¼‚æ­¥å¼•å…¥ï¼Œåœ¨ç­‰å¾…Childè¿‡ç¨‹ä¸­ï¼ŒåŠ è½½Loadç»„ä»¶ã€‚
* ä¸ºäº†è®©æ•ˆæœæ›´åŠ æ˜æ˜¾ï¼Œè¿™é‡Œä½¿ç”¨Promiseè®©Childæœ¬èº«å˜ä¸ºå¼‚æ­¥ç»„ä»¶ã€‚

App.vue

```
<template>
  <div id="main">
    <h2>{{ title }}</h2>
    <suspense>
      <template v-slot:default>
        <child />
      </template>
      <template v-slot:fallback>
        <load />
      </template>
    </suspense>
  </div>
</template>
<script>
  import { defineAsyncComponent, defineComponent, reactive, toRefs } from "vue";
  import Child from "./Child.vue";
  import Load from "./Load.vue";
  export default defineComponent({
    name: "App",
    components: {
      Child,
      Load,
    },
    setup() {
      const state = reactive({
        title: "Appç»„ä»¶",
      });
      return {
        ...toRefs(state),
      };
    },
  });
</script>
```

Child.vue

```
<template>
  <div id="Child">
    <h2>{{ title }}</h2>
  </div>
</template>
<script>
  import { defineComponent, reactive, toRefs } from "vue";
  export default defineComponent({
    name: "ChildCPN",
    async setup() {
      const state = reactive({
        title: "Childç»„ä»¶",
      });
      const State = new Promise((resolve, reject) => {
        setTimeout(() => {
          resolve({ ...toRefs(state) });
        }, 1000);
      });
      return await State;
    },
  });
</script>
```

Load.vue

```
<template>
  <div id="Load">
    <h2>{{ title }}</h2>
  </div>
</template>
<script>
  import { defineComponent, reactive, toRefs } from "vue";
  export default defineComponent({
    name: "LoadCPN",
    setup() {
      const state = reactive({
        title: "Loadç»„ä»¶,åŠ è½½ä¸­â€¦â€¦",
      });
      return {
        ...toRefs(state),
      };
    },
  });
</script>
```

æ•ˆæœï¼š

<img src="æ–°ç»„ä»¶.assets/010.gif" alt="010" style="zoom:80%;" />
